!function(e){function f(b,a){this.element=e(b),this.settings=e.extend({},d,a),this.settings.emptyIcon&&this.settings.iconsPerPage--,this.iconPicker=e("<div/>",{"class":"icons-selector",style:"position: relative",html:'<div class="selector"><span class="selected-icon"><i class="fip-icon-block"></i></span><span class="selector-button"><i class="fip-icon-down-dir"></i></span></div><div class="selector-popup" style="display: none;">'+(this.settings.hasSearch?'<div class="selector-search"><input type="text" name="" value="" placeholder="Search icon" class="icons-search-input"/><i class="fip-icon-search"></i></div>':"")+'<div class="selector-category"><select name="" class="icon-category-select" style="display: none"></select></div><div class="fip-icons-container"></div><div class="selector-footer" style="display:none;"><span class="selector-pages">1/2</span><span class="selector-arrows"><span class="selector-arrow-left" style="display:none;"><i class="fip-icon-left-dir"></i></span><span class="selector-arrow-right"><i class="fip-icon-right-dir"></i></span></span></div></div>'}),this.iconContainer=this.iconPicker.find(".fip-icons-container"),this.searchIcon=this.iconPicker.find(".selector-search i"),this.iconsSearched=[],this.isSearch=!1,this.totalPage=1,this.currentPage=1,this.currentIcon=!1,this.iconsCount=0,this.open=!1,this.searchValues=[],this.availableCategoriesSearch=[],this.triggerEvent=null,this.backupSource=[],this.backupSearch=[],this.isCategorized=!1,this.selectCategory=this.iconPicker.find(".icon-category-select"),this.selectedCategory=!1,this.availableCategories=[],this.unCategorizedKey=null,this.init()}var d={theme:"fip-grey",source:!1,emptyIcon:!0,emptyIconValue:"",iconsPerPage:20,hasSearch:!0,searchSource:!1,useAttribute:!1,attributeName:"data-icon",convertToHex:!0,allCategoryText:"From all categories",unCategorizedText:"Uncategorized"};f.prototype={init:function(){this.iconPicker.addClass(this.settings.theme),this.iconPicker.css({left:-9999}).appendTo("body");var a=this.iconPicker.outerHeight(),i=this.iconPicker.outerWidth();if(this.iconPicker.css({left:""}),this.element.before(this.iconPicker),this.element.css({visibility:"hidden",top:0,position:"relative",zIndex:"-1",left:"-"+i+"px",display:"inline-block",height:a+"px",width:i+"px",padding:"0",margin:"0 -"+i+"px 0 0",border:"0 none",verticalAlign:"top"}),!this.element.is("select")){var h=function(){for(var k=3,j=document.createElement("div"),l=j.all||[];j.innerHTML="<!--[if gt IE "+ ++k+"]><br><![endif]-->",l[0];){}return k>4?k:!k}(),g=document.createElement("div");this.triggerEvent=9!==h&&"oninput" in g?["input","keyup"]:["keyup"]}!this.settings.source&&this.element.is("select")?(this.settings.source=[],this.settings.searchSource=[],this.element.find("optgroup").length?(this.isCategorized=!0,this.element.find("optgroup").each(e.proxy(function(j,m){var l=this.availableCategories.length,k=e("<option />");k.attr("value",l),k.html(e(m).attr("label")),this.selectCategory.append(k),this.availableCategories[l]=[],this.availableCategoriesSearch[l]=[],e(m).find("option").each(e.proxy(function(n,q){var p=e(q).val(),o=e(q).html();p&&p!==this.settings.emptyIconValue&&(this.settings.source.push(p),this.availableCategories[l].push(p),this.searchValues.push(o),this.availableCategoriesSearch[l].push(o))},this))},this)),this.element.find("> option").length&&this.element.find("> option").each(e.proxy(function(j,m){var l=e(m).val(),k=e(m).html();return l&&""!==l&&l!=this.settings.emptyIconValue?(null===this.unCategorizedKey&&(this.unCategorizedKey=this.availableCategories.length,this.availableCategories[this.unCategorizedKey]=[],this.availableCategoriesSearch[this.unCategorizedKey]=[],e("<option />").attr("value",this.unCategorizedKey).html(this.settings.unCategorizedText).appendTo(this.selectCategory)),this.settings.source.push(l),this.availableCategories[this.unCategorizedKey].push(l),this.searchValues.push(k),this.availableCategoriesSearch[this.unCategorizedKey].push(k),void 0):!0},this))):this.element.find("option").each(e.proxy(function(j,m){var l=e(m).val(),k=e(m).html();l&&(this.settings.source.push(l),this.searchValues.push(k))},this)),this.backupSource=this.settings.source.slice(0),this.backupSearch=this.searchValues.slice(0),this.loadCategories()):this.initSourceIndex(),this.loadIcons(),this.selectCategory.on("change keyup",e.proxy(function(j){if(this.isCategorized===!1){return !1}var m=e(j.currentTarget),l=m.val();if("all"===m.val()){this.settings.source=this.backupSource,this.searchValues=this.backupSearch}else{var k=parseInt(l,10);this.availableCategories[k]&&(this.settings.source=this.availableCategories[k],this.searchValues=this.availableCategoriesSearch[k])}this.resetSearch(),this.loadIcons()},this)),this.iconPicker.find(".selector-button").click(e.proxy(function(){this.toggleIconSelector()},this)),this.iconPicker.find(".selector-arrow-right").click(e.proxy(function(c){this.currentPage<this.totalPage&&(this.iconPicker.find(".selector-arrow-left").show(),this.currentPage=this.currentPage+1,this.renderIconContainer()),this.currentPage===this.totalPage&&e(c.currentTarget).hide()},this)),this.iconPicker.find(".selector-arrow-left").click(e.proxy(function(c){this.currentPage>1&&(this.iconPicker.find(".selector-arrow-right").show(),this.currentPage=this.currentPage-1,this.renderIconContainer()),1===this.currentPage&&e(c.currentTarget).hide()},this)),this.iconPicker.find(".icons-search-input").keyup(e.proxy(function(j){var k=e(j.currentTarget).val();return""===k?(this.resetSearch(),void 0):(this.searchIcon.removeClass("fip-icon-search"),this.searchIcon.addClass("fip-icon-cancel"),this.isSearch=!0,this.currentPage=1,this.iconsSearched=[],e.grep(this.searchValues,e.proxy(function(l,c){return l.toLowerCase().search(k.toLowerCase())>=0?(this.iconsSearched[this.iconsSearched.length]=this.settings.source[c],!0):void 0},this)),this.renderIconContainer(),void 0)},this)),this.iconPicker.find(".selector-search").on("click",".fip-icon-cancel",e.proxy(function(){this.iconPicker.find(".icons-search-input").focus(),this.resetSearch()},this)),this.iconContainer.on("click",".fip-box",e.proxy(function(c){this.setSelectedIcon(e(c.currentTarget).find("i").attr("data-fip-value")),this.toggleIconSelector()},this)),this.iconPicker.click(function(b){return b.stopPropagation(),!1}),e("html").click(e.proxy(function(){this.open&&this.toggleIconSelector()},this))},initSourceIndex:function(){if("object"==typeof this.settings.source){if(e.isArray(this.settings.source)){this.isCategorized=!1,this.selectCategory.html("").hide(),this.settings.source=e.map(this.settings.source,function(b){return"function"==typeof b.toString?b.toString():b}),this.searchValues=e.isArray(this.settings.searchSource)?e.map(this.settings.searchSource,function(b){return"function"==typeof b.toString?b.toString():b}):this.settings.source.slice(0)}else{var a=e.extend(!0,{},this.settings.source);this.settings.source=[],this.searchValues=[],this.availableCategoriesSearch=[],this.selectedCategory=!1,this.availableCategories=[],this.unCategorizedKey=null,this.isCategorized=!0,this.selectCategory.html("");for(var n in a){var m=this.availableCategories.length,l=e("<option />");l.attr("value",m),l.html(n),this.selectCategory.append(l),this.availableCategories[m]=[],this.availableCategoriesSearch[m]=[];for(var k in a[n]){var j=a[n][k],i=this.settings.searchSource&&this.settings.searchSource[n]&&this.settings.searchSource[n][k]?this.settings.searchSource[n][k]:j;"function"==typeof j.toString&&(j=j.toString()),j&&j!==this.settings.emptyIconValue&&(this.settings.source.push(j),this.availableCategories[m].push(j),this.searchValues.push(i),this.availableCategoriesSearch[m].push(i))}}}this.backupSource=this.settings.source.slice(0),this.backupSearch=this.searchValues.slice(0),this.loadCategories()}},loadCategories:function(){this.isCategorized!==!1&&(e('<option value="all">'+this.settings.allCategoryText+"</option>").prependTo(this.selectCategory),this.selectCategory.show().val("all").trigger("change"))},loadIcons:function(){this.iconContainer.html('<i class="fip-icon-spin3 animate-spin loading"></i>'),this.settings.source instanceof Array&&this.renderIconContainer()},renderIconContainer:function(){var a,j=[];if(j=this.isSearch?this.iconsSearched:this.settings.source,this.iconsCount=j.length,this.totalPage=Math.ceil(this.iconsCount/this.settings.iconsPerPage),this.totalPage>1?this.iconPicker.find(".selector-footer").show():this.iconPicker.find(".selector-footer").hide(),this.iconPicker.find(".selector-pages").html(this.currentPage+"/"+this.totalPage+" <em>("+this.iconsCount+")</em>"),a=(this.currentPage-1)*this.settings.iconsPerPage,this.settings.emptyIcon){this.iconContainer.html('<span class="fip-box"><i class="fip-icon-block" data-fip-value="fip-icon-block"></i></span>')}else{if(j.length<1){return this.iconContainer.html('<span class="icons-picker-error"><i class="fip-icon-block" data-fip-value="fip-icon-block"></i></span>'),void 0}this.iconContainer.html("")}j=j.slice(a,a+this.settings.iconsPerPage);for(var h,i=0;h=j[i++];){var g=h;e.grep(this.settings.source,e.proxy(function(k,c){return k===h?(g=this.searchValues[c],!0):!1},this)),e("<span/>",{html:'<i data-fip-value="'+h+'" '+(this.settings.useAttribute?this.settings.attributeName+'="'+(this.settings.convertToHex?"&#x"+parseInt(h,10).toString(16)+";":h)+'"':'class="'+h+'"')+"></i>","class":"fip-box",title:g}).appendTo(this.iconContainer)}this.settings.emptyIcon||this.element.val()&&-1!==e.inArray(this.element.val(),this.settings.source)?-1===e.inArray(this.element.val(),this.settings.source)?this.setSelectedIcon():this.setSelectedIcon(this.element.val()):this.setSelectedIcon(j[0])},setHighlightedIcon:function(){this.iconContainer.find(".current-icon").removeClass("current-icon"),this.currentIcon&&this.iconContainer.find('[data-fip-value="'+this.currentIcon+'"]').parent("span").addClass("current-icon")},setSelectedIcon:function(g){if("fip-icon-block"===g&&(g=""),this.settings.useAttribute?g?this.iconPicker.find(".selected-icon").html("<i "+this.settings.attributeName+'="'+(this.settings.convertToHex?"&#x"+parseInt(g,10).toString(16)+";":g)+'"></i>'):this.iconPicker.find(".selected-icon").html('<i class="fip-icon-block"></i>'):this.iconPicker.find(".selected-icon").html('<i class="'+(g||"fip-icon-block")+'"></i>'),this.element.val(""===g?this.settings.emptyIconValue:g).trigger("change"),null!==this.triggerEvent){for(var c in this.triggerEvent){this.element.trigger(this.triggerEvent[c])}}this.currentIcon=g,this.setHighlightedIcon()},toggleIconSelector:function(){this.open=this.open?0:1,this.iconPicker.find(".selector-popup").slideToggle(300),this.iconPicker.find(".selector-button i").toggleClass("fip-icon-down-dir"),this.iconPicker.find(".selector-button i").toggleClass("fip-icon-up-dir"),this.open&&this.iconPicker.find(".icons-search-input").focus().select()},resetSearch:function(){this.iconPicker.find(".icons-search-input").val(""),this.searchIcon.removeClass("fip-icon-cancel"),this.searchIcon.addClass("fip-icon-search"),this.iconPicker.find(".selector-arrow-left").hide(),this.currentPage=1,this.isSearch=!1,this.renderIconContainer(),this.totalPage>1&&this.iconPicker.find(".selector-arrow-right").show()}},e.fn.fontIconPicker=function(a){return this.each(function(){e.data(this,"fontIconPicker")||e.data(this,"fontIconPicker",new f(this,a))}),this.setIcons=e.proxy(function(g,h){void 0===g&&(g=!1),void 0===h&&(h=!1),this.each(function(){e.data(this,"fontIconPicker").settings.source=g,e.data(this,"fontIconPicker").settings.searchSource=h,e.data(this,"fontIconPicker").initSourceIndex(),e.data(this,"fontIconPicker").resetSearch(),e.data(this,"fontIconPicker").loadIcons()})},this),this.destroyPicker=e.proxy(function(){this.each(function(){e.data(this,"fontIconPicker")&&(e.data(this,"fontIconPicker").iconPicker.remove(),e.data(this,"fontIconPicker").element.css({visibility:"",top:"",position:"",zIndex:"",left:"",display:"",height:"",width:"",padding:"",margin:"",border:"",verticalAlign:""}),e.removeData(this,"fontIconPicker"))})},this),this.refreshPicker=e.proxy(function(b){b||(b=a),this.destroyPicker(),this.each(function(){e.data(this,"fontIconPicker")||e.data(this,"fontIconPicker",new f(this,b))})},this),this}}(jQuery);